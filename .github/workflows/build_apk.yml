name: ğŸ“± Build Android APK

on:
  # å½“æ¨é€åˆ° main åˆ†æ”¯æ—¶è§¦å‘
  push:
    branches:
      - main
  # å…è®¸åœ¨ç½‘é¡µä¸Šæ‰‹åŠ¨ç‚¹å‡»æŒ‰é’®è§¦å‘
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      - name: â¬‡ï¸ 1. æ‹‰å–ä»£ç 
        uses: actions/checkout@v3

      - name: ğŸŸ¢ 2. è®¾ç½® Node.js ç¯å¢ƒ
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: â˜• 3. è®¾ç½® Java ç¯å¢ƒ (JDK 17)
        uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: ğŸ“¦ 4. å®‰è£…ä¾èµ–
        run: npm install

      - name: ğŸ”§ 5. åˆå§‹åŒ–å®‰å“ç¯å¢ƒ
        # è¿™ä¸€æ­¥ä¼šè‡ªåŠ¨ç”Ÿæˆ android æ–‡ä»¶å¤¹ï¼Œå®Œå…¨ä¸éœ€è¦æœ¬åœ°æœ‰
        run: |
          npx cap add android
          npx cap sync android

      - name: ğŸ”¨ 6. æ‰“åŒ… APK
        working-directory: ./android
        # ä½¿ç”¨ Gradle æ‰“åŒ… Debug ç‰ˆæœ¬ (å…ç­¾åï¼Œå®‰è£…æ–¹ä¾¿)
        run: ./gradlew assembleDebug

      - name: ğŸ“¤ 7. ä¸Šä¼  APK åˆ° GitHub
        uses: actions/upload-artifact@v3
        with:
          name: Jwc-Knowledge-App
          path: android/app/build/outputs/apk/debug/app-debug.apk