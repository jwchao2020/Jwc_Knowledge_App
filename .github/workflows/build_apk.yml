name: ğŸš€ è‡ªåŠ¨è½¬æ¢æ–‡æ¡£ & æ„å»º APK

on:
  push:
    branches:
      - main  # ç›‘å¬ main åˆ†æ”¯çš„æ”¹åŠ¨
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è§¦å‘

# ğŸ”‘ è®¾ç½®æƒé™ï¼Œå…è®¸è„šæœ¬ä¿®æ”¹ä»“åº“ï¼ˆç”¨äºå‘å¸ƒ HTMLï¼‰
permissions:
  contents: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      # 1. æ‹‰å–ä»£ç 
      - name: â¬‡ï¸ æ‹‰å–ä»£ç 
        uses: actions/checkout@v4

      # 2. ğŸ è®¾ç½® Python ç¯å¢ƒ
      - name: ğŸ è®¾ç½® Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      # 3. ğŸ¼ å®‰è£… Pandoc (è½¬æ¢æ ¸å¿ƒå·¥å…·)
      - name: ğŸ¼ å®‰è£… Pandoc
        run: |
          sudo apt-get update
          sudo apt-get install -y pandoc

      # 4. ğŸ”„ è¿è¡Œè½¬æ¢è„šæœ¬ (Word -> HTML)
      - name: ğŸ”„ æ‰§è¡Œæ–‡æ¡£è½¬æ¢
        run: |
          python3 build_html.py
          # éªŒè¯ä¸€ä¸‹æ˜¯å¦ç”Ÿæˆäº†æ–‡ä»¶
          ls -R Documents/content || echo "æ²¡æœ‰ç”Ÿæˆ content ç›®å½•"

      # 5. ğŸš€ å‘å¸ƒ HTML åˆ° gh-pages åˆ†æ”¯ (å®ç°åœ¨çº¿çƒ­æ›´æ–°)
      - name: ğŸš€ å‘å¸ƒåœ¨çº¿èµ„æº
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./  # å‘å¸ƒæ•´ä¸ªç›®å½•ï¼Œè¿™æ · Documents ç»“æ„ä¿æŒå®Œæ•´
          publish_branch: gh-pages  # å‘å¸ƒåˆ° gh-pages åˆ†æ”¯
          keep_files: false # è¦†ç›–æ—§æ–‡ä»¶

      # --- åˆ°è¿™é‡Œï¼Œåœ¨çº¿æ›´æ–°åŠŸèƒ½å·²ç»å®Œæˆäº† ---
      # --- ä¸‹é¢æ˜¯æ‰“åŒ… APK çš„æ­¥éª¤ (ç»™æ–°ç”¨æˆ·ç”¨) ---

      - name: ğŸŸ¢ è®¾ç½® Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: â˜• è®¾ç½® Java
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: ğŸ“¦ å®‰è£…é¡¹ç›®ä¾èµ–
        run: npm install

      - name: ğŸ”§ åˆå§‹åŒ– Capacitor
        run: |
          npx cap add android || true
          npx cap sync android

      - name: ğŸ”¨ æ„å»º APK
        working-directory: ./android
        run: ./gradlew assembleDebug

      - name: ğŸ“¤ ä¸Šä¼  APK
        uses: actions/upload-artifact@v4
        with:
          name: Jwc-Knowledge-App-Latest
          path: android/app/build/outputs/apk/debug/app-debug.apk